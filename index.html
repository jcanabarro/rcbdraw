<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Computação Gráfica :: RCBDraw</title>

    <link rel="stylesheet" type="text/css" href="libs/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="libs/fontawesome/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="libs/vue/bootstrap-vue.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
<div id="rcb">
    <rcb-navbar></rcb-navbar>
    <open-modal></open-modal>
    <save-modal></save-modal>
    <export-modal></export-modal>
    <regular-polygon-modal></regular-polygon-modal>
    <properties-modal></properties-modal>
    <about-modal></about-modal>
    <panel ref="panelFront"></panel>
    <panel ref="panelTop"></panel>
    <panel ref="panelLeft"></panel>
    <panel ref="panelPerspective"></panel>
    <element-right-click ref="elementRightClick"></element-right-click>
    <panel-right-click ref="panelRightClick"></panel-right-click>
    <toolbar></toolbar>
</div>

<script type="text/javascript" src="libs/vue/vue.js"></script>
<script type="text/javascript" src="libs/tether/tether.min.js"></script>
<script type="text/javascript" src="libs/vue/bootstrap-vue.js"></script>

<script type="text/javascript" src="components/OpenModal.js"></script>
<script type="text/javascript" src="components/PropertiesModal.js"></script>
<script type="text/javascript" src="components/SaveModal.js"></script>
<script type="text/javascript" src="components/ExportModal.js"></script>
<script type="text/javascript" src="components/RegularPolygonModal.js"></script>
<script type="text/javascript" src="components/AboutModal.js"></script>
<script type="text/javascript" src="components/RcbNavbar.js"></script>
<script type="text/javascript" src="components/Panel.js"></script>
<script type="text/javascript" src="components/Toolbar.js"></script>
<script type="text/javascript" src="components/ElementRightClick.js"></script>
<script type="text/javascript" src="components/PanelRightClick.js"></script>

<script type="text/javascript" src="js/Colors.js"></script>
<script type="text/javascript" src="js/Vertex.js"></script>
<script type="text/javascript" src="js/Polygon.js"></script>
<script type="text/javascript" src="js/Scene.js"></script>
<script type="text/javascript" src="js/Interface.js"></script>
<script type="text/javascript" src="js/Edge.js"></script>

<script type="text/javascript">
    
    let panel = null;


    window.onload = function () {
        vue = new Vue({
            el: '#rcb'
        });

        panels = Array.from(document.getElementsByClassName('canvas'));

        halfScreen = [window.innerWidth / 2 - 40, window.innerHeight / 2];

        drawInterface = new Interface();

        panels.forEach(function (panel) {

            panel.addEventListener('contextmenu', function (e) {
                toggleReset();
                vue.$refs.elementRightClick.hide();
                vue.$refs.panelRightClick.hide();
                drawInterface.selectionClick(e.clientX, e.clientY);
                if (!drawInterface.isSomethingSelected()) {
                    vue.$refs.panelRightClick.show(e.clientX, e.clientY);
                } else {
                    vue.$refs.elementRightClick.show(e.clientX, e.clientY);
                }
                e.preventDefault();
            }, false);
            
            panel.onmousedown = function () { // previne a seleção em duplo clique
                return false;
            }

            panel.addEventListener('click', function () {
                vue.$refs.elementRightClick.hide();
                vue.$refs.panelRightClick.hide();
            }, false);

            panel.width = halfScreen[0];
            panel.height = halfScreen[1];
            drawInterface.pushPanel(panel);
        });


        window.addEventListener('keyup', function (event) {
            if (event.keyCode === 27) {
                toggleReset();
            } else if (event.keyCode === 46) {
                drawInterface.deletePolygon();
            }
        }, false);
    };

    function definePolygon (sides, size, stroke, fill, mustStroke, mustFill) {
        toggleReset();
        vue.$refs.panelTop.expectPolygon(sides, size, stroke, fill, mustStroke, mustFill);
    }

    function expectSelection () {
        toggleReset();
        vue.$refs.panelTop.expectSelection();
    }

    function expectFreehand () {
        toggleReset();
        vue.$refs.panelTop.expectFreehand();
    }

    function toggleReset () {
        vue.$refs.panelTop.reset();
    }

    function duplicateSelected () {
        if (!drawInterface.isSomethingSelected()) {
            alert('Nenhum objeto selecionado.');
            return;
        }
        drawInterface.duplicateSelected();
    }

    function openRegularPolygonModal () {
        vue.$emit('show::modal', 'regular-polygon-modal');
    }

    function openPropertiesModal () {
        if (!drawInterface.isSomethingSelected()) {
            alert('Nenhum objeto selecionado.');
            return;
        }
        vue.$emit('show::modal', 'properties-modal');
    }

    function expectRotation () {
        if (!drawInterface.isSomethingSelected()) {
            alert('Nenhum objeto selecionado.');
            return;
        }
        toggleReset();
        vue.$refs.panelTop.expectRotation();
    }

    function expectTranslate () {
        if (!drawInterface.isSomethingSelected()) {
            alert('Nenhum objeto selecionado.');
            return;
        }
        toggleReset();
        vue.$refs.panelTop.expectTranslate();
    }

    function expectScale () {
        if (!drawInterface.isSomethingSelected()) {
            alert('Nenhum objeto selecionado.');
            return;
        }
        toggleReset();
        vue.$refs.panelTop.expectScale();
    }

    function expectShear (direction) {
        if (!drawInterface.isSomethingSelected()) {
            alert('Nenhum objeto selecionado.');
            return;
        }
        toggleReset();
        vue.$refs.panelTop.expectShear(direction);
    }

    function deletePolygon() {
        if (!drawInterface.isSomethingSelected()) {
            alert('Nenhum objeto selecionado.');
            return;
        }
        drawInterface.deletePolygon();
    }

    function bringForward() {
        if (!drawInterface.isSomethingSelected()) {
            alert('Nenhum objeto selecionado.');
            return;
        }
        drawInterface.bringForward();
    }

    function bringBackward() {
        if (!drawInterface.isSomethingSelected()) {
            alert('Nenhum objeto selecionado.');
            return;
        }
        drawInterface.bringBackward();
    }

</script>
</body>
</html>